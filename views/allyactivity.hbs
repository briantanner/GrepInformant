  <h1>{{title}}</h1>

  {{>allyselect}}
  
  <a href="#" class="bbcode" style="width: 100px;font-size: 10px;display:block; margin-bottom: 1em;">bbcode</a>
  {{#if alliance.Members}}
    <table class="players">
      <tr>
        <td><strong>Rank</strong></td>
        <td><strong>Name</strong></td>
        <td><strong>Towns</strong></td>
        <td><strong>Towns Delta</strong></td>
        <td><strong>Point Growth</strong></td>
        <td><strong>Att BP</strong></td>
        <td><strong>Def BP</strong></td>
        <td><strong>Total BP</strong></td>
      </tr>
      {{#each alliance.Members}}
        <tr>
          <td>{{rank}}</td>
          <td><a href="/{{../server}}/player/{{id}}">{{name}}</a></td>
          <td>{{towns}}</td>
          <td>{{towns_delta}}</td>
          <td>{{points}}</td>
          <td>{{abp}}</td>
          <td>{{dbp}}</td>
          <td> <strong>{{allbp}}</strong></td>
        </tr>
      {{/each}}
      <tr>
        <td></td>
        <td><strong>Total</strong></td>
        <td><strong>{{sum.towns}}</strong></td>
        <td><strong>{{sum.towns_delta}}</strong></td>
        <td><strong>{{sum.points}}</strong></td>
        <td><strong>{{sum.abp}}</strong></td>
        <td><strong>{{sum.dbp}}</strong></td>
        <td><strong>{{sum.allbp}}</strong></td>
      </tr>
    </table>
    <textarea style="width:600px;height:200px;white-space:pre-wrap;display:none;" class="bbcode">
    [table][**]Rank[||]Name[||]Towns[||]Towns Delta[||]Point Growth[||]Att BP[||]Def BP[||]Total BP[/**]&#13;&#10;
      {{#each players}}
        [*]{{rank}}[|][player]{{name}}[/player][|]{{towns}}[|]{{towns_delta}}[|]{{points}}[|]{{abp}}[|][b]{{allbp}}[/b][/*]&#13;&#10;
      {{/each}}
      [**][||]Total[||]{{sum.towns}}[||]{{sum.towns_delta}}[||]{{sum.points}}[||]{{sum.abp}}[||]{{sum.dbp}}[||]{{sum.allbp}}[/**]
    [/table]
    </textarea>
  {{/if}}

  {{>footer}}

  <script type="text/javascript">
    var allyEndpoint = '/activity';

    var ctrlDown = false,
      ctrlKeys = [17, 91, 93],
      cKey = 67

    $('textarea')
      .mouseup(function(e) {
        // fixes safari/chrome problem
        e.preventDefault();
      })
      .focus(function(e) {
        $(this).select();
      })
      .click(function(e) {
        $(this).select();
      })
      .keydown(function(e) {
        if (ctrlKeys.indexOf(e.keyCode) !== -1)
          ctrlDown = true;

        if (!ctrlDown) {
          console.log('!ctrlDown')
          e.preventDefault();
          return false;
        }

        if (e.keyCode !== cKey) {
          console.log('!cKey')
          e.preventDefault();
          return false;
        }

      })
      .keyup(function(e) {
        if (ctrlKeys.indexOf(e.keyCode) !== -1)
          ctrlDown = false;
        // e.preventDefault();
      });
    $('.bbcode-all').on('click', function (e) {
      e.preventDefault();
      $('table.players').toggle();
      $('textarea.bbcode').toggle();
    });
  </script>